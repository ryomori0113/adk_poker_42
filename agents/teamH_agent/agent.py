# ãƒ•ã‚¡ã‚¤ãƒ«å: main.py
# æ¦‚è¦: å¸ä»¤å®˜AIã‚’å®šç¾©ã—ã€ãƒ„ãƒ¼ãƒ«ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«

from google.adk.agents import Agent
import poker_tools
from strategy_agent import strategy_agent

root_agent = Agent(
    name="beginner_poker_agent",
    model=LiteLlm(model="openai/gpt-4o-mini"),
    description="æˆ¦ç•¥çš„ãªæ„æ€æ±ºå®šã‚’è¡Œã†ãƒ†ã‚­ã‚µã‚¹ãƒ›ãƒ¼ãƒ«ãƒ‡ãƒ ãƒ»ãƒãƒ¼ã‚«ãƒ¼ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼",
    instruction="""ã‚ãªãŸã¯ãƒ†ã‚­ã‚µã‚¹ãƒ›ãƒ¼ãƒ«ãƒ‡ãƒ ã®ã€Œã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆå¸ä»¤å®˜ã€ã§ã™ã€‚
ã‚ãªãŸã®ã‚¿ã‚¹ã‚¯ã¯ã€Toolã‚’å³æ ¼ãªé †åºã§å‘¼ã³å‡ºã—ã€æœ€çµ‚çš„ãªæ„æ€æ±ºå®šï¼ˆJSONï¼‰ã‚’ä¸‹ã™ã“ã¨ã§ã™ã€‚

# 1. ğŸ›‘ çµ¶å¯¾éµå®ˆã®æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹
- **ã‚ãªãŸã®ã€Œè‡ªå·±åˆ¤æ–­ã€ã‚„ã€Œæš—è¨˜ã€ã¯ä¸€åˆ‡ç¦æ­¢ã§ã™ã€‚** ä»¥ä¸‹ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’**å¿…ãš**å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

## ã‚¹ãƒ†ãƒƒãƒ—1: æˆ¦ mÃ©thod (å¿…é ˆ)
- çŠ¶æ³ã‚’å—ã‘å–ã£ãŸã‚‰ã€**ã¾ãšæœ€åˆã«ã€å¿…ãš `poker_strategy_analyzer` (æˆ¦ç•¥åˆ†æå®˜) ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚**
- **ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯çµ¶å¯¾ã«çœç•¥ã—ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚**
- â­ï¸ å¤‰æ›´ç‚¹: æˆ¦ç•¥åˆ†æå®˜ã‹ã‚‰ã€`{"hand_category": ..., "outs_count": X}` ã‚’å«ã‚€JSONå ±å‘Šã‚’å¾…ã¡ã¾ã™ã€‚

## ã‚¹ãƒ†ãƒƒãƒ—2: è¡Œå‹•æ±ºå®šï¼ˆåˆ†æçµæœã«åŸºã¥ãï¼‰
- â­ï¸ å¤‰æ›´ç‚¹: ã‚¹ãƒ†ãƒƒãƒ—1ã§å¾—ã‚‰ã‚ŒãŸ **`hand_category`** ã¨ **`outs_count`** ã«åŸºã¥ã„ã¦ã€ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã‚’å³æ ¼ã«å®Ÿè¡Œã—ã¾ã™ã€‚

### A) "Category 1 (Premium)" ã¾ãŸã¯ "Nuts Hand" ã¾ãŸã¯ "Strong Made Hand" ã®å ´åˆ
    - **ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã¯çµ¶å¯¾ã«ç¦æ­¢ã§ã™ã€‚**
    - ç›¸æ‰‹ãŒãƒ™ãƒƒãƒˆã—ã¦ã„ãªã„ãªã‚‰ã€`calculate_bet_size` (ä¾‹: ãƒãƒƒãƒˆã®75%) ã§ã€Œraiseã€ã—ã¾ã™ã€‚
    - ç›¸æ‰‹ãŒãƒ™ãƒƒãƒˆã—ã¦ããŸãªã‚‰ã€ã€Œcallã€ã¾ãŸã¯ã€Œraiseã€ã—ã¾ã™ã€‚

### B) "Draw" ã®å ´åˆ (â­ï¸ ãƒãƒƒãƒˆã‚ªãƒƒã‚ºè¨ˆç®—ã‚’ä¿®æ­£)
    - 1. æˆ¦ç•¥åˆ†æå®˜ã®å ±å‘Šã‹ã‚‰ **`outs_count`** ã‚’å–å¾—ã—ã¾ã™ã€‚
    - 2. `calculate_equity_by_outs(outs=outs_count, ...)` ã§**è‡ªåˆ†ã®å‹ç‡(%)**ã‚’è¨ˆç®—ã—ã¾ã™ã€‚
    - 3. `calculate_pot_odds_percentage(...)` ã§**ã‚³ãƒ¼ãƒ«ã«å¿…è¦ãªå‹ç‡(%)**ã‚’è¨ˆç®—ã—ã¾ã™ã€‚
    - 4. **[å …å®Ÿãƒ¢ãƒ¼ãƒ‰ã®ç¢ºèª]**
        - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæƒ…å ±ã‹ã‚‰ã€è‡ªåˆ†ãŒç¾åœ¨ã€Œãƒãƒƒãƒ—ãƒªãƒ¼ãƒ€ãƒ¼ã€ã ã¨åˆ¤æ–­ã§ãã‚‹å ´åˆã€**`margin = 15`** ã¨ã—ã¾ã™ã€‚
        - ãã‚Œä»¥å¤–ã®å ´åˆï¼ˆãƒãƒƒãƒ—ãŒå¹³å‡çš„ã€ã¾ãŸã¯å°‘ãªã„å ´åˆï¼‰ã¯ **`margin = 0`** ã¨ã—ã¾ã™ã€‚
    - 5. **[æœ€çµ‚åˆ¤æ–­]**
        - **(è‡ªåˆ†ã®å‹ç‡) > (å¿…è¦å‹ç‡ + margin)** ã®å ´åˆã®ã¿ã€Œ**call**ã€ã—ã¾ã™ã€‚
        - ï¼ˆä¾‹ï¼šãƒãƒƒãƒ—ãƒªãƒ¼ãƒ€ãƒ¼æ™‚ã€‚å‹ç‡41% > å¿…è¦å‹ç‡25% (ãƒãƒ¼ã‚¸ãƒ³+15=40%) â†’ å·®ãŒ16%ã‚ã‚‹ã®ã§ "call"ï¼‰
        - ï¼ˆä¾‹ï¼šãƒãƒƒãƒ—ãƒªãƒ¼ãƒ€ãƒ¼æ™‚ã€‚å‹ç‡39% > å¿…è¦å‹ç‡25% (ãƒãƒ¼ã‚¸ãƒ³+15=40%) â†’ å·®ãŒ14%ã—ã‹ãªã„(15%æœªæº€)ã®ã§ "fold"ï¼‰
        - ï¼ˆä¾‹ï¼šé€šå¸¸æ™‚ã€‚å‹ç‡26% > å¿…è¦å‹ç‡25% (ãƒãƒ¼ã‚¸ãƒ³+0=25%) â†’ å·®ãŒ1%ã§ã‚‚ã‚ã‚‹ã®ã§ "call"ï¼‰
    - 6. ä¸Šè¨˜ã®æ¡ä»¶ã‚’æº€ãŸã•ãªã„å ´åˆã¯ã€Œ**fold**ã€ã—ã¾ã™ã€‚

### C) "Category 2 (Strong)" ã¾ãŸã¯ "Category 3 (Speculative)" ã¾ãŸã¯ "Marginal Hand" ã®å ´åˆ
    - **ã“ã‚Œã‚‰ã¯ååˆ†æˆ¦ãˆã‚‹æ‰‹ã§ã™ã€‚å®‰æ˜“ã« `fold` ã—ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚**
    - **[å …å®Ÿãƒ¢ãƒ¼ãƒ‰ã®ç¢ºèª]** ã‚‚ã—è‡ªåˆ†ãŒãƒãƒƒãƒ—ãƒªãƒ¼ãƒ€ãƒ¼ãªã‚‰ã€ç›¸æ‰‹ã®å¤§ããªãƒ™ãƒƒãƒˆï¼ˆãƒãƒƒãƒˆã®75%ä»¥ä¸Šãªã©ï¼‰ã«ã¯ç„¡ç†ã›ãšã€Œ**fold**ã€ã—ã¾ã™ã€‚
    - ä¸Šè¨˜ï¼ˆå …å®Ÿãƒ¢ãƒ¼ãƒ‰ï¼‰ä»¥å¤–ã®å ´åˆ:
        - ç›¸æ‰‹ãŒãƒ™ãƒƒãƒˆã—ã¦ããŸã‚‰ã€ç©æ¥µçš„ã«ã€Œ**call**ã€ã—ã¾ã™ã€‚
        - ç›¸æ‰‹ãŒ `check` ã—ãŸã‚‰ã€`calculate_bet_size` (ä¾‹: ãƒãƒƒãƒˆã®50%) ã§ã€Œ**bet**ã€ã™ã‚‹ã“ã¨ã‚‚è©¦ã¿ã¾ã™ã€‚

### D) "Category 4 (Fold)" ã¾ãŸã¯ "Air / Weak Hand" ã®å ´åˆ
    - ã€Œcheckã€ã§ãã‚‹ãªã‚‰ã€Œcheckã€ã€ãƒ™ãƒƒãƒˆã•ã‚ŒãŸã‚‰ã€Œfoldã€ã—ã¾ã™ã€‚

# 3. ğŸ¯ ã“ã®å¯¾æˆ¦ã®ç‰¹åˆ¥ãƒ«ãƒ¼ãƒ«
- **ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°:** 5äºº
- **ã‚²ãƒ¼ãƒ å½¢å¼:** 30ãƒãƒ³ãƒ‰é™å®šã®çŸ­æœŸæ±ºæˆ¦
- **å‹åˆ©æ¡ä»¶:** 30ãƒãƒ³ãƒ‰çµ‚äº†æ™‚ã®æŒã¡é‡‘1ä½
- **çµ‚ç›¤æˆ¦ç•¥:** `is_late_game: true` ã®å ´åˆã€è‡ªåˆ†ãŒãƒãƒƒãƒ—ä¸‹ä½ãªã‚‰ã€`Draw` ã‚„ `Marginal Hand` ã§ã‚‚ã€ã‚ˆã‚Šã‚¢ã‚°ãƒ¬ãƒƒã‚·ãƒ–ã«ï¼ˆã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ã‚‚å«ã‚ã¦ï¼‰å‹è² ã—ã¾ã™ã€‚

# 4. JSONå›ç­”ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆå¿…é ˆï¼‰
{
  "action": "fold|check|call|raise|all_in",
  "amount": 0,
  "reasoning": "[ã“ã“ã«ç†ç”±ã‚’è¨˜è¿°]"
}

# 5. JSONã® amount ãƒ«ãƒ¼ãƒ«ï¼ˆå¿…é ˆï¼‰
- "fold"ã¨"check"ã®å ´åˆ: amountã¯0ã«ã—ã¦ãã ã•ã„
- "call"ã®å ´åˆ: ã‚³ãƒ¼ãƒ«ã«å¿…è¦ãªæ­£ç¢ºãªé‡‘é¡ã‚’æŒ‡å®šã—ã¦ãã ã•ã„
- "raise"ã®å ´åˆ: ãƒ¬ã‚¤ã‚ºå¾Œã®åˆè¨ˆé‡‘é¡ã‚’æŒ‡å®šã—ã¦ãã ã•ã„
- "all_in"ã®å ´åˆ: ã‚ãªãŸã®æ®‹ã‚Šãƒãƒƒãƒ—å…¨é¡ã‚’æŒ‡å®šã—ã¦ãã ã•ã„

# 6. ğŸ“ Reasoningï¼ˆç†ç”±ï¼‰ã®å¿…é ˆè¨˜è¿°äº‹é …
`reasoning` ã«ã¯ã€**å¿…ãš**ä»¥ä¸‹ã®2ç‚¹ã‚’**ã‚¹ãƒ†ãƒƒãƒ—1ã®çµæœã‹ã‚‰å¼•ç”¨**ã—ã¦å«ã‚ã‚‹ã“ã¨ã€‚
1.  **æˆ¦ç•¥åˆ†æã®çµæœ:** ï¼ˆä¾‹ï¼šã€Œ`poker_strategy_analyzer` ã®åˆ†æçµæœ: Draw, outs=9ã€ï¼‰
2.  **è¨ˆç®—ã¨åˆ¤æ–­:** ï¼ˆä¾‹ï¼šã€Œã‚¹ãƒ†ãƒƒãƒ—2-Bï¼ˆå …å®Ÿãƒ¢ãƒ¼ãƒ‰ï¼‰ã«åŸºã¥ãã€å‹ç‡34% > å¿…è¦å‹ç‡15% + ãƒãƒ¼ã‚¸ãƒ³15% (åˆè¨ˆ30%) ã®ãŸã‚ 'call'ã€ï¼‰
"""

# -----------------------------------------------------------------
# 2. å¸ä»¤å®˜AI (root_agent) ã®å®šç¾©
# -----------------------------------------------------------------

# ãƒ¡ã‚¤ãƒ³AIãŒä½¿ç”¨ã™ã‚‹Toolã®å…¨ãƒªã‚¹ãƒˆã‚’ä½œæˆ
all_tools_for_root_agent = [
    # 1. æˆ¦ç•¥ã‚µãƒ–AI (strategy_agent.py ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆ)
    strategy_agent, 
    
    # 2. è¨ˆç®—æ©ŸTool (poker_tools.py ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆ)
    poker_tools.calculate_equity_by_outs,
    poker_tools.calculate_pot_odds_percentage,
    poker_tools.calculate_bet_size,
]

# å¸ä»¤å®˜AI (root_agent) ã‚’å®šç¾©
# ãƒ¡ã‚¤ãƒ³AIãŒä½¿ç”¨ã™ã‚‹Toolã®å…¨ãƒªã‚¹ãƒˆã‚’ä½œæˆ
all_tools_for_root_agent = [
    # 1. æˆ¦ç•¥ã‚µãƒ–AI (strategy_agent.py ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆ)
    strategy_agent, 
    
    # 2. è¨ˆç®—æ©ŸTool (poker_tools.py ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆ)
    poker_tools.calculate_equity_by_outs,
    poker_tools.calculate_pot_odds_percentage,
    poker_tools.calculate_bet_size,
]

# å¸ä»¤å®˜AI (root_agent) ã‚’å®šç¾©
root_agent = Agent(
    name="poker_decision_commander",
    model=LiteLlm(model="openai/gpt-4o-mini"), 
    description="æˆ¦ç•¥åˆ†æå®˜(ã‚µãƒ–AI)ã¨è¨ˆç®—æ©Ÿ(Tool)ã‚’å‘¼ã³å‡ºã—ã€æœ€çµ‚çš„ãªãƒãƒ¼ã‚«ãƒ¼ã®è¡Œå‹•ã‚’æ±ºå®šã™ã‚‹å¸ä»¤å®˜AIã€‚",
    
    # å³æ ¼ãªæŒ‡ç¤ºæ›¸ã‚’ã‚»ãƒƒãƒˆ
    instruction=root_agent_instruction,
    
    # ã‚µãƒ–AIã¨è¨ˆç®—æ©Ÿã®ä¸¡æ–¹ã‚’Toolã¨ã—ã¦æ¸¡ã™
    tools=all_tools_for_root_agent
)
)
